# node-express-mongdb-api

## Core software to start the api:

• Node and npm (nodemon is a nice to have)

• Express

• Mongo and mongoose

• babel-cli, babel-preset-env, babel-preset-stage-0

## Server directory structure

### Option 1

/server

&nbsp;&nbsp;/controllers

&nbsp;&nbsp;/models

&nbsp;&nbsp;/routes

&nbsp;&nbsp;/middleware

### Option 2
/server

&nbsp;&nbsp;/api

&nbsp;&nbsp;&nbsp;&nbsp;/someTopic (i.e. users)

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/someTopic.controller.js

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/someTopic.model.js

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/someTopic.route.js


&nbsp;&nbsp;&nbsp;&nbsp;/anotherTopic (i.e. catalogItems)

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/anotherTopic.controller.js

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/anotherTopic.model.js

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/anotherTopic.route.js

&nbsp;&nbsp;&nbsp;&nbsp;/api.js
```javascript
//api.js
import express from 'express';
const router = express.Router();

// api router will mount other routers
// for all our resources
router.use('/someTopic', require('./someTopic/someTopic.route'));
router.use('/categories', require('./anotherTopic/anotherTopic.route'));

exports default router;
```

&nbsp;&nbsp;/models

&nbsp;&nbsp;/routes

&nbsp;&nbsp;/middleware


## Routes example

```javascript
// index.js

import express from 'express';
const app = express();
const router = express.Router();

import someRoute from './server/routes/someRoute';
app.use('/routePath', contactsRoutes(router));
```

```javascript
// someRoute.js

export default (router) => {
  // get and post use the same path
  router.route('/')
    .get((req, res) => res.send(`GET request on ${req.baseUrl}`))
    .post((req, res) => res.json(req.body))
    
  // put and delete use the same path
  router.route('/:id') 
    .put((req, res) => {
      // find the item by id in the DB, update it, and send it back
      // let item = find item and update
      res.json(item);
    })
    .delete((req, res) => {
      // find the item by id in the DB, delete it, and send it or a message back 
      // let item = find item
      // delete(item);
      res.json(item);
    });

  return router;
};
```


## Middleware example

```javascript
import express from 'express';
import morgan from 'morgan';

export default (app) => {
  app.use(morgan('dev'));
  app.use(express.urlencoded({ extended: true }));
  app.use(express.json());
};
```

## Mongodb 

[Installation and first steps](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x/)

In a mongodb database we have collections (e.g. users) that have documents (objects) that represent items in that collection

"Create the data directory.
Before you start MongoDB for the first time, create the directory to which the mongod process will write data. By default, the mongod process uses the /data/db directory. If you create a directory other than this one, you must specify that directory in the dbpath option when starting the mongod process later in this procedure.

The following example command creates the default /data/db directory:"

(You may need to use `sudo` to run the command below)

`mkdir -p /data/db` (-p, --parents: no error if existing, make parent directories as needed)

This is the directory where mongodb stores your data.

Make sure you have read and write permission on that directory otherwise the command below will not work. If you don't have permissions, set them using these commands:

`sudo chmod 0755 /data/db sudo chown $USER /data/db`

__run mongodb__

`mongod`


You should see something like this on your terminal:

![mongo running](img/mongo.png)

Mongo listens for connections on port 27017.


## Mongoose

Mongoose allows us to set a schema for each collection and define what each key/value pair in the item (object) takes as a type

### Robomongo [https://robomongo.org/](https://robomongo.org/)

Robomongo is a GUI that allows us to interact with our mongdb database directly. 

After you start your mongodb (`mongod`) you can open the GUI and you should be able to see the dbs hosted on your system.

You should see this screen

![robomongo](img/robomongo.png)

You can see the databases you created and their content like so:


![dbs](img/dbs.png)


## Test with Postman

For post requests use x-www-form-urlencoded:

__Success:__ -- object sent back from mongodb


![success](img/success.png)


__Fail:__ (key "firstName" misspelled) -- error generated by mongodb

![fail](img/fail.png)


__Get contacts__

![get](img/get.png)


__Get contact by ID__

![contact](img/contact.png)



